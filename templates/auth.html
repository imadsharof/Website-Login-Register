{% extends "base.html" %}
{% block title %}Se connecter / S’inscrire • Mitraillette Royale{% endblock %}
{% block content %}

<section class="auth">
  <div class="auth-card" role="dialog" aria-labelledby="authTitle">
    <header class="auth-head">
      <div class="auth-glyph" aria-hidden="true"></div>
      <div>
        <h1 id="authTitle">Bienvenue</h1>
        <p class="muted">Identifiez-vous pour continuer</p>
      </div>
    </header>

    <div class="auth-tabs" role="tablist" aria-label="Choisir une action">
      <button class="auth-tab active" id="tab-login" role="tab" aria-controls="panel-login" aria-selected="true">Connectez-vous</button>
      <button class="auth-tab" id="tab-signup" role="tab" aria-controls="panel-signup" aria-selected="false">Inscrivez-vous</button>
    </div>

    <!-- LOGIN -->
    <section id="panel-login" class="auth-panel active" role="tabpanel" aria-labelledby="tab-login">
      <form method="post" action="/login" autocomplete="on">
        <label class="field">
          <span>Adresse e-mail</span>
          <input class="textbox" type="email" name="email" placeholder="ex. nom@domaine.com" required />
        </label>

        <label class="field">
          <span>Mot de passe</span>
          <div class="input-row">
            <input id="lpass" class="textbox" type="password" name="password" placeholder="••••••••" required />
            <button class="eye-btn" type="button" data-target="lpass" aria-label="Afficher/masquer le mot de passe">👁</button>
          </div>
        </label>

        <div class="auth-actions">
          <button class="btn btn--primary" type="submit">Se connecter</button>
          <a class="btn btn--google" href="/login/google">Continuer avec Google</a>
        </div>
      </form>
    </section>

    <!-- SIGNUP -->
    <section id="panel-signup" class="auth-panel" role="tabpanel" aria-labelledby="tab-signup">
      <form method="post" action="/register" autocomplete="on" novalidate>
        <label class="field">
          <span>Adresse e-mail</span>
          <input class="textbox" type="email" name="email" placeholder="ex. nom@domaine.com" required />
        </label>

        <label class="field">
          <span>Mot de passe</span>
          <div class="input-row">
            <input id="spass" class="textbox" type="password" name="password" placeholder="Au moins 8 caractères" required />
            <button class="eye-btn" type="button" data-target="spass" aria-label="Afficher/masquer le mot de passe">👁</button>
          </div>
        </label>

        <label class="field">
          <span>Confirmer le mot de passe</span>
          <div class="input-row">
            <input id="sconfirm" class="textbox" type="password" name="confirm" placeholder="Répétez le mot de passe" required />
            <button class="eye-btn" type="button" data-target="sconfirm" aria-label="Afficher/masquer le mot de passe">👁</button>
          </div>
        </label>

        {% with pw_errors = get_flashed_messages(category_filter=['signup_pw']) %}
          {% if pw_errors %}
            <div class="auth-help auth-help--error">
              <strong>Votre mot de passe doit respecter :</strong>
              <ul>
                {% for e in pw_errors %}<li>{{ e }}</li>{% endfor %}
              </ul>
            </div>
          {% endif %}
        {% endwith %}

        <div class="auth-actions">
          <button class="btn btn--primary" type="submit">Créer mon compte</button>
          <a class="btn btn--google" href="/login/google">Continuer avec Google</a>
        </div>
      </form>
    </section>
  </div>
</section>

<script>
  // Tabs
  const tLogin=document.getElementById('tab-login'), tSignup=document.getElementById('tab-signup');
  const pLogin=document.getElementById('panel-login'), pSignup=document.getElementById('panel-signup');
  function show(which){const isLogin=which==='login';
    [tLogin,tSignup].forEach(e=>e.classList.remove('active'));
    [pLogin,pSignup].forEach(e=>e.classList.remove('active'));
    (isLogin?tLogin:tSignup).classList.add('active');
    (isLogin?pLogin:pSignup).classList.add('active');
    tLogin.setAttribute('aria-selected',isLogin); tSignup.setAttribute('aria-selected',!isLogin);
    location.hash=isLogin?'#login':'#signup';
  }
  tLogin.onclick=()=>show('login'); tSignup.onclick=()=>show('signup'); if(location.hash==='#signup') show('signup');

  // Eyes
  document.querySelectorAll('.eye-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id=btn.getAttribute('data-target'); const input=document.getElementById(id);
      input.type = input.type === 'password' ? 'text' : 'password';
    });
  });
</script>
{% endblock %}
